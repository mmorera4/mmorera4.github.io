<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart, Crescent Moon, and Rainbow Animation</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #0d335f;
            margin: 0;
        }
        canvas {
            border: 2px solid white;
        }
        .plyr {
            margin-top: 20px;
        }
    </style>

    <!-- Include Plyr CSS -->
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
</head>
<body>

<input type="file" id="audio-upload" accept="audio/*" />
<select id="shape-selector">
    <option value="heart">Heart</option>
    <option value="moon">Crescent Moon</option>
    <option value="rainbow">Rainbow</option>
</select>

<!-- Audio element for Plyr -->
<audio id="player" controls></audio>

<!-- Include Plyr JS -->
<script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/addons/p5.sound.min.js"></script>

<script>
let amplitude, fft;
let song;
let shapes = []; // Array de posicions de les formes
let numShapes = 10; // Nombre de formes a dibuixar
let selectedShape = 'heart'; // Forma per defecte

function setup() {
  let canvas = createCanvas(600, 600);
  canvas.parent(document.body);

  amplitude = new p5.Amplitude();
  fft = new p5.FFT();

  // Inicialitzar les formes amb posicions aleatòries
  for (let i = 0; i < numShapes; i++) {
    let x = random(width);
    let y = random(height);
    shapes.push({x: x, y: y});
  }

  // Setup file input listener
  let fileInput = document.getElementById('audio-upload');
  fileInput.addEventListener('change', handleFileUpload);

  // Dropdown listener
  let shapeSelector = document.getElementById('shape-selector');
  shapeSelector.addEventListener('change', function() {
    selectedShape = this.value;
  });
}

function draw() {
  background('#0d335f');

  if (!song || !song.isPlaying()) {
    return;
  }

  let level = amplitude.getLevel();
  let size = map(level, 0, 1, 0.5, 1.5); // Escala de la mida de la forma

  let spectrum = fft.analyze();
  let bass = fft.getEnergy("bass");
  let treble = fft.getEnergy("treble");

  let r = map(bass, 0, 255, 50, 255);
  let b = map(treble, 0, 255, 50, 255);
  let g = map(level, 0, 1, 50, 255);

  noFill();
  stroke(r, g, b);
  strokeWeight(3);

  // Dibuixar múltiples formes (cors, llunes o arcs de Sant Martí)
  shapes.forEach(shape => {
    push();
    translate(shape.x, shape.y);
    scale(size);

    if (selectedShape === 'heart') {
      drawHeart(); // Dibuixa el cor
    } else if (selectedShape === 'moon') {
      drawCrescentMoon(); // Dibuixa la lluna creixent
    } else if (selectedShape === 'rainbow') {
      drawRainbow(); // Dibuixa l'arc de Sant Martí
    }

    pop();
  });
}

function drawHeart() {
  beginShape();
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(107, 50.1875);
vertex(106, 50.1875);
vertex(105, 50.1875);
vertex(105, 50.1875);
vertex(105, 50.1875);
vertex(105, 50.1875);
vertex(104, 50.1875);
vertex(104, 50.1875);
vertex(104, 50.1875);
vertex(104, 50.1875);
vertex(104, 50.1875);
vertex(103, 50.1875);
vertex(103, 50.1875);
vertex(103, 50.1875);
vertex(102, 50.1875);
vertex(102, 49.1875);
vertex(102, 49.1875);
vertex(101, 49.1875);
vertex(101, 49.1875);
vertex(101, 49.1875);
vertex(100, 49.1875);
vertex(99, 49.1875);
vertex(98, 49.1875);
vertex(98, 49.1875);
vertex(97, 49.1875);
vertex(96, 49.1875);
vertex(95, 49.1875);
vertex(95, 49.1875);
vertex(95, 49.1875);
vertex(94, 49.1875);
vertex(94, 49.1875);
vertex(94, 49.1875);
vertex(93, 49.1875);
vertex(93, 49.1875);
vertex(93, 49.1875);
vertex(92, 49.1875);
vertex(91, 49.1875);
vertex(91, 49.1875);
vertex(90, 49.1875);
vertex(90, 49.1875);
vertex(90, 50.1875);
vertex(89, 50.1875);
vertex(89, 50.1875);
vertex(88, 50.1875);
vertex(88, 50.1875);
vertex(87, 50.1875);
vertex(87, 51.1875);
vertex(87, 51.1875);
vertex(86, 51.1875);
vertex(85, 51.1875);
vertex(84, 51.1875);
vertex(84, 52.1875);
vertex(83, 52.1875);
vertex(83, 52.1875);
vertex(82, 52.1875);
vertex(82, 52.1875);
vertex(81, 52.1875);
vertex(81, 52.1875);
vertex(80, 53.1875);
vertex(80, 53.1875);
vertex(80, 53.1875);
vertex(80, 53.1875);
vertex(79, 53.1875);
vertex(79, 53.1875);
vertex(79, 53.1875);
vertex(79, 54.1875);
vertex(78, 54.1875);
vertex(78, 54.1875);
vertex(77, 54.1875);
vertex(77, 55.1875);
vertex(76, 55.1875);
vertex(75, 56.1875);
vertex(75, 56.1875);
vertex(74, 56.1875);
vertex(73, 57.1875);
vertex(73, 57.1875);
vertex(73, 57.1875);
vertex(72, 57.1875);
vertex(72, 57.1875);
vertex(72, 57.1875);
vertex(71, 58.1875);
vertex(71, 58.1875);
vertex(70, 58.1875);
vertex(70, 59.1875);
vertex(69, 59.1875);
vertex(69, 59.1875);
vertex(68, 60.1875);
vertex(67, 60.1875);
vertex(66, 61.1875);
vertex(65, 61.1875);
vertex(65, 61.1875);
vertex(65, 62.1875);
vertex(64, 62.1875);
vertex(64, 62.1875);
vertex(64, 62.1875);
vertex(63, 63.1875);
vertex(63, 63.1875);
vertex(62, 63.1875);
vertex(62, 64.1875);
vertex(62, 64.1875);
vertex(61, 65.1875);
vertex(61, 65.1875);
vertex(60, 65.1875);
vertex(60, 66.1875);
vertex(59, 66.1875);
vertex(59, 67.1875);
vertex(59, 67.1875);
vertex(59, 67.1875);
vertex(58, 68.1875);
vertex(58, 68.1875);
vertex(58, 68.1875);
vertex(58, 69.1875);
vertex(57, 70.1875);
vertex(57, 70.1875);
vertex(56, 71.1875);
vertex(56, 72.1875);
vertex(55, 73.1875);
vertex(55, 74.1875);
vertex(55, 74.1875);
vertex(55, 75.1875);
vertex(54, 75.1875);
vertex(54, 75.1875);
vertex(54, 76.1875);
vertex(53, 76.1875);
vertex(53, 77.1875);
vertex(53, 77.1875);
vertex(52, 78.1875);
vertex(52, 79.1875);
vertex(52, 79.1875);
vertex(51, 80.1875);
vertex(51, 81.1875);
vertex(51, 81.1875);
vertex(50, 82.1875);
vertex(50, 83.1875);
vertex(50, 84.1875);
vertex(50, 84.1875);
vertex(49, 85.1875);
vertex(49, 86.1875);
vertex(49, 86.1875);
vertex(49, 87.1875);
vertex(49, 88.1875);
vertex(48, 88.1875);
vertex(48, 89.1875);
vertex(48, 89.1875);
vertex(48, 90.1875);
vertex(48, 91.1875);
vertex(47, 91.1875);
vertex(47, 92.1875);
vertex(47, 92.1875);
vertex(47, 93.1875);
vertex(47, 94.1875);
vertex(47, 94.1875);
vertex(47, 94.1875);
vertex(47, 95.1875);
vertex(47, 95.1875);
vertex(47, 95.1875);
vertex(47, 96.1875);
vertex(47, 96.1875);
vertex(47, 97.1875);
vertex(47, 98.1875);
vertex(47, 98.1875);
vertex(47, 99.1875);
vertex(47, 100.1875);
vertex(47, 101.1875);
vertex(47, 101.1875);
vertex(47, 102.1875);
vertex(47, 102.1875);
vertex(47, 103.1875);
vertex(47, 103.1875);
vertex(47, 104.1875);
vertex(47, 104.1875);
vertex(47, 105.1875);
vertex(47, 105.1875);
vertex(47, 106.1875);
vertex(47, 106.1875);
vertex(47, 107.1875);
vertex(47, 107.1875);
vertex(47, 108.1875);
vertex(47, 108.1875);
vertex(47, 109.1875);
vertex(48, 109.1875);
vertex(48, 109.1875);
vertex(48, 109.1875);
vertex(48, 109.1875);
vertex(48, 110.1875);
vertex(48, 110.1875);
vertex(48, 111.1875);
vertex(48, 111.1875);
vertex(48, 111.1875);
vertex(49, 112.1875);
vertex(49, 112.1875);
vertex(49, 113.1875);
vertex(49, 113.1875);
vertex(49, 114.1875);
vertex(49, 114.1875);
vertex(49, 114.1875);
vertex(49, 115.1875);
vertex(49, 115.1875);
vertex(49, 116.1875);
vertex(50, 116.1875);
vertex(50, 117.1875);
vertex(50, 117.1875);
vertex(50, 118.1875);
vertex(50, 118.1875);
vertex(50, 118.1875);
vertex(50, 119.1875);
vertex(51, 119.1875);
vertex(51, 120.1875);
vertex(51, 120.1875);
vertex(51, 121.1875);
vertex(51, 121.1875);
vertex(51, 121.1875);
vertex(51, 122.1875);
vertex(52, 122.1875);
vertex(52, 122.1875);
vertex(52, 123.1875);
vertex(52, 123.1875);
vertex(53, 123.1875);
vertex(53, 124.1875);
vertex(54, 124.1875);
vertex(54, 125.1875);
vertex(55, 125.1875);
vertex(55, 125.1875);
vertex(55, 125.1875);
vertex(55, 126.1875);
vertex(56, 126.1875);
vertex(56, 126.1875);
vertex(56, 127.1875);
vertex(57, 127.1875);
vertex(57, 127.1875);
vertex(57, 128.1875);
vertex(57, 128.1875);
vertex(57, 128.1875);
vertex(58, 129.1875);
vertex(58, 129.1875);
vertex(58, 129.1875);
vertex(58, 130.1875);
vertex(58, 130.1875);
vertex(59, 130.1875);
vertex(59, 131.1875);
vertex(59, 131.1875);
vertex(60, 131.1875);
vertex(60, 132.1875);
vertex(60, 132.1875);
vertex(60, 132.1875);
vertex(60, 132.1875);
vertex(61, 133.1875);
vertex(61, 133.1875);
vertex(61, 133.1875);
vertex(62, 134.1875);
vertex(62, 134.1875);
vertex(62, 134.1875);
vertex(62, 134.1875);
vertex(62, 134.1875);
vertex(63, 134.1875);
vertex(63, 135.1875);
vertex(63, 135.1875);
vertex(64, 135.1875);
vertex(64, 135.1875);
vertex(64, 136.1875);
vertex(64, 136.1875);
vertex(65, 136.1875);
vertex(65, 136.1875);
vertex(65, 137.1875);
vertex(66, 137.1875);
vertex(66, 137.1875);
vertex(66, 137.1875);
vertex(67, 138.1875);
vertex(68, 138.1875);
vertex(68, 138.1875);
vertex(68, 138.1875);
vertex(69, 138.1875);
vertex(69, 139.1875);
vertex(69, 139.1875);
vertex(70, 139.1875);
vertex(70, 139.1875);
vertex(71, 140.1875);
vertex(72, 140.1875);
vertex(72, 140.1875);
vertex(73, 141.1875);
vertex(73, 141.1875);
vertex(73, 141.1875);
vertex(74, 141.1875);
vertex(74, 141.1875);
vertex(74, 141.1875);
vertex(74, 141.1875);
vertex(75, 142.1875);
vertex(75, 142.1875);
vertex(75, 142.1875);
vertex(75, 142.1875);
vertex(76, 142.1875);
vertex(76, 143.1875);
vertex(77, 143.1875);
vertex(77, 143.1875);
vertex(77, 143.1875);
vertex(78, 143.1875);
vertex(78, 143.1875);
vertex(79, 143.1875);
vertex(79, 143.1875);
vertex(80, 144.1875);
vertex(81, 144.1875);
vertex(81, 144.1875);
vertex(82, 144.1875);
vertex(82, 144.1875);
vertex(83, 144.1875);
vertex(83, 144.1875);
vertex(83, 144.1875);
vertex(84, 144.1875);
vertex(84, 144.1875);
vertex(84, 144.1875);
vertex(84, 144.1875);
vertex(85, 144.1875);
vertex(86, 145.1875);
vertex(86, 145.1875);
vertex(86, 145.1875);
vertex(87, 145.1875);
vertex(87, 145.1875);
vertex(87, 145.1875);
vertex(88, 145.1875);
vertex(88, 145.1875);
vertex(88, 145.1875);
vertex(88, 146.1875);
vertex(89, 146.1875);
vertex(89, 146.1875);
vertex(90, 146.1875);
vertex(90, 146.1875);
vertex(91, 146.1875);
vertex(92, 146.1875);
vertex(92, 146.1875);
vertex(93, 146.1875);
vertex(94, 146.1875);
vertex(94, 146.1875);
vertex(94, 146.1875);
vertex(95, 146.1875);
vertex(95, 146.1875);
vertex(95, 146.1875);
vertex(96, 146.1875);
vertex(96, 146.1875);
vertex(97, 146.1875);
vertex(97, 146.1875);
vertex(98, 146.1875);
vertex(98, 146.1875);
vertex(99, 146.1875);
vertex(99, 146.1875);
vertex(99, 146.1875);
vertex(99, 146.1875);
vertex(99, 146.1875);
vertex(99, 146.1875);
vertex(100, 145.1875);
vertex(100, 145.1875);
vertex(100, 145.1875);
vertex(100, 145.1875);
vertex(101, 145.1875);
vertex(102, 145.1875);
vertex(102, 145.1875);
vertex(102, 145.1875);
vertex(102, 145.1875);
vertex(103, 145.1875);
vertex(103, 145.1875);
vertex(103, 145.1875);
vertex(103, 144.1875);
vertex(104, 144.1875);
vertex(104, 144.1875);
vertex(104, 144.1875);
vertex(104, 144.1875);
vertex(104, 144.1875);
vertex(104, 144.1875);
vertex(104, 144.1875);
vertex(103, 144.1875);
vertex(101, 144.1875);
vertex(100, 144.1875);
vertex(98, 143.1875);
vertex(98, 143.1875);
vertex(97, 143.1875);
vertex(96, 143.1875);
vertex(96, 143.1875);
vertex(94, 142.1875);
vertex(94, 142.1875);
vertex(93, 142.1875);
vertex(92, 141.1875);
vertex(92, 141.1875);
vertex(92, 141.1875);
vertex(91, 141.1875);
vertex(91, 140.1875);
vertex(90, 140.1875);
vertex(90, 140.1875);
vertex(90, 139.1875);
vertex(89, 139.1875);
vertex(89, 139.1875);
vertex(88, 138.1875);
vertex(88, 138.1875);
vertex(88, 138.1875);
vertex(88, 137.1875);
vertex(87, 137.1875);
vertex(87, 137.1875);
vertex(86, 136.1875);
vertex(86, 135.1875);
vertex(85, 135.1875);
vertex(85, 134.1875);
vertex(84, 134.1875);
vertex(84, 133.1875);
vertex(83, 133.1875);
vertex(82, 132.1875);
vertex(82, 132.1875);
vertex(82, 132.1875);
vertex(81, 131.1875);
vertex(80, 130.1875);
vertex(80, 129.1875);
vertex(79, 129.1875);
vertex(79, 129.1875);
vertex(79, 129.1875);
vertex(79, 129.1875);
vertex(79, 129.1875);
vertex(78, 128.1875);
vertex(78, 128.1875);
vertex(78, 128.1875);
vertex(78, 127.1875);
vertex(77, 127.1875);
vertex(77, 127.1875);
vertex(77, 126.1875);
vertex(77, 126.1875);
vertex(77, 126.1875);
vertex(76, 126.1875);
vertex(76, 126.1875);
vertex(76, 125.1875);
vertex(75, 125.1875);
vertex(75, 125.1875);
vertex(75, 125.1875);
vertex(75, 124.1875);
vertex(74, 124.1875);
vertex(74, 123.1875);
vertex(74, 123.1875);
vertex(74, 122.1875);
vertex(73, 122.1875);
vertex(73, 121.1875);
vertex(72, 121.1875);
vertex(72, 120.1875);
vertex(72, 120.1875);
vertex(72, 119.1875);
vertex(71, 119.1875);
vertex(71, 118.1875);
vertex(71, 118.1875);
vertex(71, 118.1875);
vertex(71, 118.1875);
vertex(71, 117.1875);
vertex(70, 117.1875);
vertex(70, 116.1875);
vertex(70, 116.1875);
vertex(70, 115.1875);
vertex(70, 115.1875);
vertex(69, 114.1875);
vertex(69, 113.1875);
vertex(69, 113.1875);
vertex(69, 112.1875);
vertex(69, 112.1875);
vertex(69, 111.1875);
vertex(69, 111.1875);
vertex(69, 110.1875);
vertex(68, 109.1875);
vertex(68, 108.1875);
vertex(68, 106.1875);
vertex(67, 105.1875);
vertex(67, 103.1875);
vertex(67, 102.1875);
vertex(67, 101.1875);
vertex(67, 101.1875);
vertex(66, 99.1875);
vertex(66, 99.1875);
vertex(66, 98.1875);
vertex(66, 97.1875);
vertex(66, 96.1875);
vertex(66, 95.1875);
vertex(65, 95.1875);
vertex(65, 94.1875);
vertex(65, 94.1875);
vertex(65, 94.1875);
vertex(65, 93.1875);
vertex(65, 93.1875);
vertex(65, 92.1875);
vertex(65, 92.1875);
vertex(65, 92.1875);
vertex(65, 91.1875);
vertex(65, 90.1875);
vertex(65, 89.1875);
vertex(65, 88.1875);
vertex(65, 88.1875);
vertex(65, 88.1875);
vertex(65, 88.1875);
vertex(65, 87.1875);
vertex(65, 87.1875);
vertex(66, 86.1875);
vertex(66, 86.1875);
vertex(66, 85.1875);
vertex(66, 85.1875);
vertex(66, 85.1875);
vertex(66, 84.1875);
vertex(66, 84.1875);
vertex(66, 83.1875);
vertex(67, 83.1875);
vertex(67, 82.1875);
vertex(67, 82.1875);
vertex(67, 82.1875);
vertex(67, 81.1875);
vertex(68, 81.1875);
vertex(68, 81.1875);
vertex(68, 80.1875);
vertex(68, 80.1875);
vertex(68, 79.1875);
vertex(68, 79.1875);
vertex(69, 79.1875);
vertex(69, 78.1875);
vertex(69, 78.1875);
vertex(69, 78.1875);
vertex(70, 77.1875);
vertex(70, 77.1875);
vertex(70, 76.1875);
vertex(70, 76.1875);
vertex(71, 76.1875);
vertex(71, 75.1875);
vertex(71, 75.1875);
vertex(71, 75.1875);
vertex(71, 75.1875);
vertex(72, 74.1875);
vertex(72, 74.1875);
vertex(72, 74.1875);
vertex(72, 73.1875);
vertex(73, 73.1875);
vertex(73, 73.1875);
vertex(73, 72.1875);
vertex(73, 72.1875);
vertex(74, 72.1875);
vertex(74, 71.1875);
vertex(75, 71.1875);
vertex(75, 70.1875);
vertex(76, 70.1875);
vertex(76, 70.1875);
vertex(76, 70.1875);
vertex(76, 69.1875);
vertex(77, 69.1875);
vertex(77, 69.1875);
vertex(77, 68.1875);
vertex(79, 68.1875);
vertex(80, 67.1875);
vertex(81, 66.1875);
vertex(82, 65.1875);
vertex(82, 65.1875);
vertex(82, 65.1875);
vertex(83, 64.1875);
vertex(83, 64.1875);
vertex(84, 64.1875);
vertex(85, 63.1875);
vertex(85, 63.1875);
vertex(85, 63.1875);
vertex(85, 63.1875);
vertex(86, 63.1875);
vertex(86, 62.1875);
vertex(87, 62.1875);
vertex(87, 61.1875);
vertex(88, 61.1875);
vertex(88, 61.1875);
vertex(89, 60.1875);
vertex(90, 60.1875);
vertex(90, 60.1875);
vertex(91, 60.1875);
vertex(91, 59.1875);
vertex(92, 59.1875);
vertex(93, 59.1875);
vertex(93, 59.1875);
vertex(94, 59.1875);
vertex(94, 58.1875);
vertex(95, 58.1875);
vertex(95, 58.1875);
vertex(96, 58.1875);
vertex(96, 58.1875);
vertex(97, 57.1875);
vertex(97, 57.1875);
vertex(97, 57.1875);
vertex(98, 57.1875);
vertex(98, 57.1875);
vertex(98, 56.1875);
vertex(99, 56.1875);
vertex(99, 56.1875);
vertex(100, 56.1875);
vertex(100, 55.1875);
vertex(100, 55.1875);
vertex(101, 55.1875);
vertex(101, 55.1875);
vertex(101, 55.1875);
vertex(101, 54.1875);
vertex(102, 54.1875);
vertex(102, 54.1875);
vertex(102, 54.1875);
vertex(102, 54.1875);
vertex(102, 54.1875);
vertex(102, 54.1875);
vertex(102, 54.1875);
vertex(102, 54.1875);
vertex(102, 54.1875);
vertex(102, 54.1875);
vertex(102, 53.1875);
vertex(102, 53.1875);
vertex(102, 53.1875);
vertex(102, 53.1875);
vertex(102, 53.1875);
vertex(102, 53.1875);
vertex(103, 53.1875);
vertex(103, 53.1875);
vertex(103, 52.1875);
vertex(104, 52.1875);
vertex(104, 52.1875);
vertex(105, 52.1875);
vertex(106, 52.1875);
vertex(106, 52.1875);
vertex(106, 52.1875);
vertex(106, 52.1875);
vertex(106, 52.1875);
vertex(107, 52.1875);
vertex(107, 52.1875);
vertex(107, 52.1875);
vertex(107, 51.1875);
vertex(108, 51.1875);
vertex(108, 51.1875);
vertex(108, 51.1875);
vertex(108, 51.1875);
vertex(108, 51.1875);
vertex(108, 51.1875);
vertex(108, 51.1875);
vertex(108, 51.1875);
vertex(108, 51.1875);
vertex(108, 51.1875);
vertex(108, 51.1875);
vertex(108, 51.1875);
vertex(108, 51.1875);
vertex(108, 51.1875);
vertex(108, 51.1875);
vertex(108, 51.1875);
vertex(108, 51.1875);
vertex(108, 51.1875);
vertex(108, 51.1875);
vertex(108, 51.1875);
vertex(108, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
vertex(107, 51.1875);
endShape();
}

function drawCrescentMoon() {
  // Dibuix de la lluna creixent
  fill(0);
  ellipse(0, 0, 50, 100); // Lluna plena
  fill('#0d335f');
  ellipse(10, 0, 50, 100); // Ombra per crear la creixent
}

function drawRainbow() {
  // Dibuix d'un arc de Sant Martí
  let radius = 50;
  let colors = ['#FF0000', '#FF7F00', '#FFFF00', '#00FF00', '#0000FF', '#4B0082', '#8B00FF']; // Colors de l'arc de Sant Martí

  for (let i = 0; i < colors.length; i++) {
    stroke(colors[i]);
    noFill();
    arc(0, 0, radius + i * 10, radius + i * 10, PI, TWO_PI); // Dibuixar arcs concèntrics amb diferents colors
  }
}

function handleFileUpload(event) {
  let file = event.target.files[0];
  if (file && file.type.startsWith('audio/')) {
    let fileURL = URL.createObjectURL(file);

    // Update Plyr player with the new audio file
    const audioElement = document.getElementById('player');
    audioElement.src = fileURL;
    player.source = {
      type: 'audio',
      sources: [{ src: fileURL, type: file.type }]
    };

    // Load sound for p5.js analysis
    loadSound(fileURL, soundLoaded);
  } else {
    console.error('Please upload a valid audio file');
  }
}

function soundLoaded(loadedSong) {
  if (song && song.isPlaying()) {
    song.stop();
  }
  song = loadedSong;
  song.play();
  amplitude.setInput(song);
  fft.setInput(song);
}
</script>

</body>
</html>
